<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Grantsville Community Action</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; line-height: 1.6; color: #111; }
    header { background: #333; color: #fff; padding: 1rem; text-align: center; }
    main { padding: 1.5rem; max-width: 800px; margin: auto; }
    h1, h2, h3 { margin-top: 1.2rem; }
    .update { margin: 1.5rem 0; padding: 1rem 0; border-top: 1px solid #ccc; }
    .financial-summary { width: 100%; border-collapse: collapse; margin: 0.75rem 0; }
    .financial-summary th, .financial-summary td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; vertical-align: top; }
    .financial-summary thead th { background: #f6f6f6; }
    .editable { background: #f1f1f1; padding: 0.05rem 0.25rem; border-radius: 4px; outline: none; }
    .muted { color: #555; }
    footer { background: #f4f4f4; padding: 1rem; text-align: center; margin-top: 2rem; }
  </style>
</head>
<body>
  <header>
    <h1>Grantsville Community Action</h1>
    <p>Standing together against government overreach</p>
  </header>

  <main>
    <section>
      <h2>Contact</h2>
      <p>Name: Kevin Casey</p>
      <p>Email: GVCP</p>
    </section>

    <section>
      <h2>Updates / News</h2>

      <!-- Oct 4 Community Meeting (kept as-is) -->
      <article class="update">
        <h3>Open Community Meeting — Oct 4, 2025</h3>
        <p>
          Join us at the Grantsville City Library, Large Meeting Room, on
          <strong>Saturday, October 4</strong> for an open community meeting.
          We’ll provide updates, host Q&amp;A, and take signups and donations.
        </p>
      </article>

      <!-- Financial Status Update with Auto Totals -->
      <article class="update" aria-labelledby="fin-status">
        <h3 id="fin-status">Financial Status Update — Oct 3, 2025</h3>
        <p>Thank you to everyone contributing to the effort. Here’s where the war chest stands today:</p>

        <table class="financial-summary" role="table" aria-label="Financial Summary">
          <thead>
            <tr>
              <th scope="col">Metric</th>
              <th scope="col">Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Total Contributions to Date</td>
              <td>
                <span id="contrib" class="editable" contenteditable="true" aria-label="Total Contributions">
                  $8,625.00
                </span>
                <div class="muted">Edit this value only</div>
              </td>
            </tr>
            <tr>
              <td>Total Expenses to Date</td>
              <td>
                <span id="expenses" class="editable" contenteditable="true" aria-label="Total Expenses">
                  $7,907.71
                </span>
                <div class="muted">Edit this value only</div>
              </td>
            </tr>
            <tr>
              <td><strong>Balance in War Chest</strong></td>
              <td><strong id="balance">$717.29</strong></td>
            </tr>
            <tr>
              <td>Initial Goal</td>
              <td id="goal">$20,000.00</td>
            </tr>
            <tr>
              <td>Remaining to Goal</td>
              <td id="remain">$19,282.71</td>
            </tr>
            <tr>
              <td>Progress</td>
              <td id="progress">43.1% of goal (net of expenses)</td>
            </tr>
          </tbody>
        </table>

        <p>
          We’re still a long way from the initial war chest goal of <strong>$20,000</strong>.
          If, after the completion of this action, there is any positive balance, it will either be
          returned to contributors proportional to their contribution, <em>or</em> allocated to another
          worthy cause or action by a majority vote.
        </p>
      </article>

      <!-- Oct 2 Update (kept as-is) -->
      <article class="update">
        <h3>Update — Oct 2, 2025</h3>
        <p>
          Our community continues to organize against the city’s recent overreach.
          Stay tuned here for updates and ways to get involved.
        </p>
      </article>

    </section>
  </main>

  <footer>
    <p>&copy; 2025 Grantsville Community Action</p>
  </footer>

  <script>
    (function () {
      const $ = (id) => document.getElementById(id);

      function parseCurrency(str) {
        if (!str) return 0;
        // Keep digits, minus, and dot; remove everything else
        const cleaned = (str + '').replace(/[^0-9.\-]/g, '');
        const n = parseFloat(cleaned);
        return isNaN(n) ? 0 : n;
      }

      function formatCurrency(n) {
        try {
          return n.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
        } catch {
          // Fallback for older browsers
          const sign = n < 0 ? '-' : '';
          const val = Math.abs(n).toFixed(2);
          return sign + '$' + val.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
      }

      function recalc() {
        const contribVal = parseCurrency($('contrib').innerText);
        const expenseVal = parseCurrency($('expenses').innerText);
        const goalVal = parseCurrency($('goal').innerText);

        const balance = contribVal - expenseVal;
        const remain = Math.max(goalVal - Math.max(0, balance), 0);
        const progress = goalVal > 0 ? Math.max(0, Math.min(1, balance / goalVal)) : 0;

        $('balance').innerText = formatCurrency(balance);
        $('remain').innerText  = formatCurrency(remain);
        $('progress').innerText = (progress * 100).toFixed(1) + '% of goal (net of expenses)';

        // Normalize user-edited fields to currency format while preserving caret position on blur only
      }

      // Recalculate on load
      recalc();

      // Recalculate on edits; format on blur
      ['contrib', 'expenses'].forEach(id => {
        const el = $(id);
        el.addEventListener('input', recalc);
        el.addEventListener('blur', () => {
          const val = parseCurrency(el.innerText);
          el.innerText = formatCurrency(val);
          recalc();
        });
        // Prevent Enter from inserting new lines
        el.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') { e.preventDefault(); el.blur(); }
        });
      });
    })();
  </script>
</body>
</html>
